"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[563],{9563:(e,i,l)=>{l.r(i),l.d(i,{default:()=>p});var t=l(6252);const s={class:"clearfix qiniu-upload"},a={key:0},r=(0,t._)("div",{class:"ant-upload-text"},"上传照片",-1),n=["src"];var o=l(2922),u=l(2262);const d=(0,t.aZ)({components:{PlusOutlined:o.Z},props:{keys:{type:Array,default:()=>[]},errorKeys:{type:Array,default:()=>[]},show:Boolean,limit:{type:Number,default:1/0}},setup(e,{emit:i}){const l=(0,u.iH)(!1),s=(0,u.iH)(""),a=(0,u.iH)(e.show),r=(0,u.iH)(""),n=(0,u.qj)({fileList:[],urlLoaded:!1}),o=(0,u.Fl)((()=>[...e.keys,...e.errorKeys]));return(0,t.YP)(o,(i=>{!async function(i){if(!i.length||n.urlLoaded)return;const l=[],{data:t}=await qiniuFileUrlList({fileKeys:i});Object.keys(t).forEach(((i,s)=>{const a=e.errorKeys.includes(i)?"error":"done",r=t[i];l.push({fileKey:i,url:r,status:a,uid:`${s}${i}`})})),n.fileList=l,n.urlLoaded=!0}(i)}),{immediate:!0}),{previewShow:l,imgUrl:s,displayUpload:a,token:r,...(0,u.BK)(n),previewHide:()=>{l.value=!1},previewImage:async e=>{e.url||e.preview||(e.preview=await function(e){return new Promise(((i,l)=>{const t=new FileReader;t.readAsDataURL(e),t.onload=()=>i(t.result),t.onerror=e=>l(e)}))}(e.originFileObj)),s.value=e.url||e.preview,l.value=!0},changeFiles:l=>{const{file:t}=l;let s=[...l.fileList];if("removed"===t.status){const{uid:e}=t,i=n.fileList.findIndex((i=>i.uid===e));n.fileList.splice(i,1)}else e.limit!==1/0?n.fileList=s.slice(-e.limit):n.fileList=s;if(s.every((e=>"uploading"!==e.status))){const e=[];s.forEach((i=>{i.fileKey?e.push(i.fileKey):i.response&&e.push(i.response.key)})),i("revise",{keys:e,fileList:s})}},clearFiles:()=>{n.fileList=[]}}}}),p=(0,l(3744).Z)(d,[["render",function(e,i,l,o,u,d){const p=(0,t.up)("plus-outlined"),c=(0,t.up)("a-upload"),f=(0,t.up)("a-modal");return(0,t.wg)(),(0,t.iD)("div",s,[(0,t.Wm)(c,{"file-list":e.fileList,disabled:!e.displayUpload,action:"https://upload-cn-east-2.qiniup.com",data:{token:e.token},accept:"image/jpeg,image/jpg,image/png","list-type":"picture-card",multiple:"",onPreview:e.previewImage,onChange:e.changeFiles},{default:(0,t.w5)((()=>[e.displayUpload&&e.fileList.length<e.limit?((0,t.wg)(),(0,t.iD)("div",a,[(0,t.WI)(e.$slots,"default",{},(()=>[(0,t.Wm)(p),r]))])):(0,t.kq)("",!0)])),_:3},8,["file-list","disabled","data","onPreview","onChange"]),(0,t.Wm)(f,{centered:"",visible:e.previewShow,footer:null,onCancel:e.previewHide},{default:(0,t.w5)((()=>[(0,t._)("img",{style:{width:"100%"},src:e.imgUrl},null,8,n)])),_:1},8,["visible","onCancel"])])}]])}}]);